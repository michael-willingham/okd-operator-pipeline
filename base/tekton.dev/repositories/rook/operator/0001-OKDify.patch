From 3faaac9293a9b4de16e6e3d711d0f66e3809f346 Mon Sep 17 00:00:00 2001
From: SupremeMortal <6178101+SupremeMortal@users.noreply.github.com>
Date: Mon, 11 Mar 2024 19:09:44 +0000
Subject: [PATCH] OKDify

---
 Makefile             | 10 ++++++++++
 images/ceph/Makefile | 12 ++++++------
 2 files changed, 16 insertions(+), 6 deletions(-)

diff --git a/Makefile b/Makefile
index 140093b5f..cb4322bbf 100644
--- a/Makefile
+++ b/Makefile
@@ -264,3 +264,13 @@ help: ## Show this help menu.
 	@grep --no-filename -E '^[a-zA-Z_%-. ]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}'
 	@echo ""
 	@echo "$$HELPTEXT"
+
+.PHONY: okd-install okd-lint okd-build
+
+okd-install: install
+
+okd-lint: lint
+
+okd-build: build
+
+okd-test: test
\ No newline at end of file
diff --git a/images/ceph/Makefile b/images/ceph/Makefile
index e93dab7d9..e6f4dfe5c 100755
--- a/images/ceph/Makefile
+++ b/images/ceph/Makefile
@@ -32,7 +32,7 @@ GOHOST := GOOS=$(GOHOSTOS) GOARCH=$(GOHOSTARCH) go
 MANIFESTS_DIR=../../deploy/examples
 
 ifeq ($(BUILD_CONTEXT_DIR),)
-BUILD_CONTEXT_DIR := $(shell mktemp -d)
+BUILD_CONTEXT_DIR := ../../
 endif
 
 # Note: as of version 1.3 of operator-sdk, the url format changed to:
@@ -97,9 +97,9 @@ endif
 		-t $(CEPH_IMAGE) \
 		$(BUILD_CONTEXT_DIR);\
 	fi
-	@if [ -z "$(SAVE_BUILD_CONTEXT_DIR)" ]; then\
-		rm -fr $(BUILD_CONTEXT_DIR);\
-	fi
+#	@if [ -z "$(SAVE_BUILD_CONTEXT_DIR)" ]; then\
+#		rm -fr $(BUILD_CONTEXT_DIR);\
+#	fi
 
 # call this before building multiple arches in parallel to prevent parallel build processes from
 # conflicting
@@ -122,9 +122,9 @@ $(OPERATOR_SDK):
 csv: $(OPERATOR_SDK) $(YQv3)
 	@echo generate csv with latest operator-sdk
 	@mkdir -p ../../build/csv/ceph
-	@../../build/csv/csv-gen.sh
+	@cd ../../ && build/csv/csv-gen.sh
 	@# #adding 2>/dev/null since CI doesn't seems to be creating bundle.Dockerfile file
-	@rm bundle.Dockerfile 2> /dev/null || true
+	@#rm bundle.Dockerfile 2> /dev/null || true
 
 csv-clean: ## Remove existing OLM files.
 	@rm -fr ../../build/csv/ceph/${go env GOARCH}
-- 
2.43.2

